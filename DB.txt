CREATE TABLE IF NOT EXISTS job_embeddings (
    job_id TEXT PRIMARY KEY,          -- The ID from SerpAPI (e.g., "SAzGoncB...")
    job_title TEXT NOT NULL,          -- For display
    category TEXT NOT NULL,           -- THE FILTER: "Software Engineering", "Data Science"
    location TEXT,                    -- Secondary Filter: "Mumbai", "Remote"
    description_embedding vector(768),-- The MPNet Embeddings (768 dims)
    metadata JSONB,                   -- Catch-all: salary, apply_link, company_name, etc.
    ingestion_month VARCHAR(7),       -- "2026-01" (For data versioning)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- The Speed Layer (Indexes)
-- HNSW Index: Makes vector search O(log n) instead of O(n)
CREATE INDEX IF NOT EXISTS idx_vec_search 
ON job_embeddings USING hnsw (description_embedding vector_cosine_ops);

-- B-Tree Index: Makes filtering by category instant
CREATE INDEX IF NOT EXISTS idx_category 
ON job_embeddings (category);

docker exec -it resume-postgres psql -U postgres -d postgres -c "
CREATE TABLE IF NOT EXISTS role_definitions (
    role_id SERIAL PRIMARY KEY,
    job_title TEXT UNIQUE,
    internal_category TEXT,
    priority_tier TEXT,
    
    -- The 'Vibe' (Used for fast retrieval)
    anchor_embedding vector(768), # contain role summary resposiblity experience etc 
    
    -- The 'Checklist' (Used for detailed scoring)
    full_definition JSONB, #contain skill , experience , education etc
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP #version tracking 
);"