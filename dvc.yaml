stages:
  ingest:
    cmd: python data_ingestion/jd_ingestion/serp_api/serpapi_ingest.py
    deps:
      - data_ingestion/jd_ingestion/serp_api/serpapi_ingest.py
      - data_ingestion/jd_ingestion/serp_api/serpapi_client.py   
      - data_ingestion/jd_ingestion/serp_api/priority_scheduler.py 
      - data/constants/jobs.csv
      - data/constants/locations.yaml
      - utils/paths.py 
      - utils
    params:
      - serpapi_ingestion
      - ingest.current_month
    outs:
      - data/raw/serpapi/${ingest.current_month}
    
  process_jd_raw_jsons:
    cmd: python data_ingestion\processors\process_data.py
    deps:
      - data_ingestion/processors/process_data.py
      - data/raw/serpapi/${ingest.current_month}  # Depends on the raw folder
      - utils/            # Depends on utils logic
    outs:
      - data/processed/serpapi/${ingest.current_month}.csv

  label_scraped_jobs:
    cmd: python src/label_jobs.py
    deps:
      - src/label_jobs.py
      - data/processed/serpapi/${ingest.current_month}.csv  # Triggers if any month folder or CSV changes
      - utils/
    outs:
      - data/final/serpapi/${ingest.current_month}.csv